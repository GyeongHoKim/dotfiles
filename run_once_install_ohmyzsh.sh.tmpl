{{- if ne .chezmoi.os "windows" -}}
#!/bin/bash

OS="$(uname -s)"
case "${OS}" in
    Linux*)
        ;;
    Darwin*)
        ;;
    *)
        echo "Unsupported operating system: ${OS}"
        exit 0
        ;;
esac

if [ ! -d "$HOME/.oh-my-zsh" ]; then
    echo "Waiting for zsh to be installed..."
    max_attempts=60 # 60 retries * 5 seconds = 300 seconds (5 minutes)
    attempt_num=1

    while ! command -v zsh &> /dev/null; do
        if [ "$attempt_num" -ge "$max_attempts" ]; then
            echo "Error: zsh not found after $max_attempts attempts (5 minutes). Exiting."
            exit 1
        fi
        echo "zsh not found yet, waiting 5 seconds (attempt $attempt_num/$max_attempts)..."
        sleep 5
        attempt_num=$((attempt_num + 1))
    done
    echo "zsh found, proceeding with Oh My Zsh installation."
	echo "Getting ohmyz.sh"
	sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended --keep-zshrc --skip-chsh
else
	echo ".oh-my-zsh already found, skipping."
fi
{{- end -}}
