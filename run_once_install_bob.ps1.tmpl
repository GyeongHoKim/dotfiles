{{- if eq .chezmoi.os "windows" }}
# Bob-nvim Installation Script
# This script installs bob-nvim (Neovim version manager)
# It runs once during initial setup

$ErrorActionPreference = "Stop"

Write-Host "Starting bob-nvim installation..." -ForegroundColor Green

# Check if bob is already installed
if (Get-Command bob -ErrorAction SilentlyContinue) {
    Write-Host "bob-nvim is already installed." -ForegroundColor Green
    $bobVersion = bob --version
    Write-Host "  Installed version: $bobVersion" -ForegroundColor Cyan
    exit 0
}

Write-Host "`nInstalling bob-nvim..." -ForegroundColor Cyan
try {
    # Use the official bob installation script
    Write-Host "  Downloading and running bob installation script..." -ForegroundColor Yellow
    Invoke-RestMethod -Uri "https://raw.githubusercontent.com/MordechaiHadad/bob/master/scripts/install.ps1" | Invoke-Expression
    
    Write-Host "  ✓ bob-nvim installed successfully" -ForegroundColor Green
    
    # Refresh PATH to make bob available
    $bobPath = "$env:USERPROFILE\.local\share\bob\nvim-bin"
    if (Test-Path $bobPath) {
        $env:Path = "$bobPath;$env:Path"
    }
}
catch {
    Write-Host "  ✗ Failed to install bob-nvim" -ForegroundColor Red
    Write-Host "    Error: $_" -ForegroundColor Red
    exit 1
}

# Verify installation
Write-Host "`nVerifying bob-nvim installation..." -ForegroundColor Cyan
try {
    # Wait a moment for PATH to be updated
    Start-Sleep -Seconds 2
    
    # Refresh PATH again
    $bobPath = "$env:USERPROFILE\.local\share\bob\nvim-bin"
    if (Test-Path $bobPath) {
        $env:Path = "$bobPath;$env:Path"
    }
    
    $bobVersion = bob --version
    Write-Host "  ✓ bob-nvim installed successfully" -ForegroundColor Green
    Write-Host "  Version: $bobVersion" -ForegroundColor Cyan
}
catch {
    Write-Host "  ✗ bob-nvim installation verification failed" -ForegroundColor Red
    Write-Host "    Error: $_" -ForegroundColor Red
    Write-Host "    You may need to restart your terminal and run 'bob --version' to verify." -ForegroundColor Yellow
}

Write-Host "`n========================================" -ForegroundColor Green
Write-Host "bob-nvim installation complete!" -ForegroundColor Green
Write-Host "========================================" -ForegroundColor Green
Write-Host ""
Write-Host "Next steps:" -ForegroundColor Yellow
Write-Host "1. Restart your terminal to ensure PATH is updated" -ForegroundColor White
Write-Host "2. Install Neovim: bob install latest" -ForegroundColor White
Write-Host "3. Use Neovim: bob use latest" -ForegroundColor White
Write-Host ""
{{- end }}
